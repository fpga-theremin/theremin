<html>
<head>
<title>FPGA Based Theremin Project</title>
<link rel="stylesheet" type="text/css" href="css/styles.css">
</head>
<body>
<div class="page">

<h1>FPGA Based Theremin Project</h1>

<p>The goal of this project is to provide open source DIY build of FPGA based digital <a href="https://en.wikipedia.org/wiki/Theremin">Theremin</a></p>

<p>Unlike analog theremins, digital theremin is in general capacitive sensor which measures distance from hands to antennas, and digital synthesizer which generates sound.

<h2>Table of Contents</h2>

<ul>
  <li><a href="#hardware">Hardware</a></li>
  <ul>
    <li><a href="#3rdparty_hardware">Third-party hardware</a></li>
    <li><a href="#antennas">Antennas and cabinet construction</a></li>
    <li><a href="#pcbs">All PCBs</a></li>
  </ul>
  <li><a href="#software">Software</a></li>
  <li><a href="#links">Useful links</a></li>
</ul>

<h2>Existing digital theremins available</h2>

<p>There is one well known digital theremin on market, Moog Theremini.
<p><img width="200px" src="https://images-na.ssl-images-amazon.com/images/I/61s-UjpnH7L._SL1500_.jpg">
<p>Due to high latency, it's mostrly unplayable, just a toy.

<p>There is a good digital theremin project, <a href="https://www.gaudi.ch/OpenTheremin/">Open.Theremin</a> but it still uses too poor hardware (Arduino UNO) as a base.
<p><img width="200px" src="https://www.gaudi.ch/OpenTheremin/images/stories/OpenTheremin/OTV3/otv3.jpg">

<p>Dewster's D-Lev FPGA theremin project is in development since 2012. Good FPGA based design, produces realistic sound without latency. Although, currently used hardware has not enough resources. 
<a href="http://thereminworld.com/Forums/T/32389/build-project-dewsters-d-lev-digital-theremin">Build project</a> for this theremin with professionally made cabinet.</p>

<p>In this project, we will try to provide easy to build DIY theremin design with potentially unlimited capabilities.</p>


<h2 id="hardware">Hardware</h2>

<h3 id="3rdparty_hardware">Choosing FPGA board and other third party hardware</h3>

<p>Why FPGA?
<ul>
  <li>Allows to implement high precision very sensitive antenna capacity sensors - cannot be done with general purpose MCUs</li>
  <li>Wide range of audio DSP algorithms may be implemented in FPGA</li>
  <li>Low latency: FPGA is able to update pitch and volume for each audio sample</li>
  <li>Hardware acceleration of display is possible (e.g. update current note in on-screen tuner in realtime)</li>
</ul>

<p>Why PSOC?
<ul>
  <li>PSOC FPGA development boards provide one or more ARM cores which may handle a lot of non-realtime functionality like GUI and reduce FPGA resources usage</li>
  <li>ARM hardware cores in PSOC provide better performance than softcores, and have hardware floating point support</li>
  <li>Rich GUI may be implemented using PSOC</li>
  <li>PSOC development boards have a lot of SDRAM which is needed, e.g. for reverberation effects</li>
  <li>Harware SDRAM controller with DMA support in PSOC - with softcore, you will spend a lot of resources for SDRAM controller even if board contains SDRAM</li>
</ul>

<p>Why Xilinx
<ul>
  <li>The only choice is between Xilinx and Intel(Altera). Other vendors provide less mature tools, with lower functionality.</li>
  <li>I'm more familiar with Xilinx solutions</li>
  <li>Xilinx provides free license for bare metal programming of PSOC (Vivado WebPack). (AFAIK, there is no free license for bare-metal applications for Intel)</li>
  <li>Xilinx Series 7 devices have bigger LUTs, DSP modules, BRAMs</li>
</ul>

<p>Digilent Cora Z7 board (either 7007 or 7010) is inexpensive solution which mets all hardware requirements for this project.

<p>For audio playback / recording, we need some audio codec board(s). Digilent PMod I2S2 and AMP3 were selected.

<p>It makes sense to add touch screen LCD for rich GUI functionality and advanced controls. Waveshare 4.3inch display was selected.

<p>Even with touch screen, it makes sense to have hardware controls: encoders, buttons, pedals.

<h4>List of third party devices or boards needed for this design</h4>
<table width="100%">
<col width="35%"></col><col width="35%"></col><col width="15%"></col><col width="15%"></col>
<tr><th>Device</th><th>Features</th><th>Store link</th><th>Datasheet</th></tr>
<tr>
  <td><span class="sectionlink">Digilent Cora Z7</span><br><img width="50%" src="https://cdn10.bigcommerce.com/s-7gavg/products/616/images/5062/Cora-obl-600__34871.1527186771.1280.1280.png?c=2"></td>
  <td>Xilinx Zynq 7007/7010 based development board<br>
      <p>The Digilent Cora Z7 is a ready-to-use, low-cost, and easily embeddable development platform designed around the powerful Zynq-7000 All-Programmable System-on-Chip (APSoC) from Xilinx. The Zynq-7000 architecture tightly integrates a single or dual core 667MHz ARM Cortex-A9 processor with a Xilinx 7-series FPGA. This pairing grants the ability to surround the processor with a unique set of software-defined peripherals and controllers, tailored for the target application.
      <p>Arduino/chipkit shield connector and 2 Pmod connectors
      <p>512 MB DDR3 memory
      <p>17,600(14,400) LUTs, 35,200()28,800 Flip-flops, 270 KB(225 KB) block RAM
  </td>
  <td><a href="https://store.digilentinc.com/cora-z7-zynq-7000-single-core-and-dual-core-options-for-arm-fpga-soc-development/">Digilent store</a> $99/$129</td>
  <td><a href="https://reference.digilentinc.com/reference/programmable-logic/cora-z7/reference-manual?_ga=2.138121072.1989832465.1562070957-922137789.1552552836">Reference manual</a></td>
</tr>
<tr>
  <td><span class="sectionlink">Digilent PMod I2S2</span><br><img width="30%" src="https://cdn10.bigcommerce.com/s-7gavg/products/614/images/4977/Pmod_I2S2_-_Oblique_-_600__05682.1522959592.1280.1280.png?c=2"></td>
  <td>24bit I2S 48000Hz stereo Line In / Line Out</td>
  <td><a href="https://store.digilentinc.com/pmod-i2s2-stereo-audio-input-and-output/">Digilent store</a> $21.99</td>
  <td><a href="https://reference.digilentinc.com/reference/pmod/pmodi2s2/reference-manual?_ga=2.129018060.1989832465.1562070957-922137789.1552552836">Reference manual</a></td>
</tr>
<tr>
  <td><span class="sectionlink">Digilent PMod AMP3</span><br><img width="30%" src="https://cdn10.bigcommerce.com/s-7gavg/products/164/images/3829/Pmod_AMP3__98407.1456865842.1280.1280.png?c=2"></td>
  <td>24bit I2S 48000Hz stereo Phones Amplifier</td>
  <td><a href="https://store.digilentinc.com/pmod-amp3-stereo-power-amplifier/">Digilent store</a> $9.99</td>
  <td><a href="https://cdn10.bigcommerce.com/s-7gavg/products/164/images/3829/Pmod_AMP3__98407.1456865842.1280.1280.png?c=2">Reference manual</a></td>
</tr>
<tr>
  <td><span class="sectionlink">5V 2.5A Switching Power Supply</span><br><img width="30%" src="https://cdn10.bigcommerce.com/s-7gavg/products/270/images/3786/5V_2.5A_Power_Supply_box_600__75335.1455146831.1280.1280.png?c=2"></td>
  <td>5V, 2.5A</td>
  <td><a href="https://store.digilentinc.com/5v-2-5a-switching-power-supply/">Digilent store</a> $12.99</td>
  <td>No reference manual</td>
</tr>
<tr>
  <td><span class="sectionlink">4.3inch Capacitive Touch LCD, 800x480</span><br><img width="40%" src="https://www.waveshare.com/media/catalog/product/cache/1/image/800x800/9df78eab33525d08d6e5fb8d27136e95/4/_/4.3inch-capacitive-touch-lcd-1.jpg"> <img width="40%" src="https://www.waveshare.com/media/catalog/product/cache/1/image/800x800/9df78eab33525d08d6e5fb8d27136e95/4/_/4.3inch-capacitive-touch-lcd-4.jpg"></td>
  <td>RGB interface<br>2x20 2.54mm pin header or FPC connector<br>Touch screen controller accessible via I2C</td>
  <td><a href="https://www.waveshare.com/product/modules/oleds-lcds/graphic-lcd/4.3inch-capacitive-touch-lcd.htm">Waveshare store</a> $27.99</td>
  <td><a href="https://www.waveshare.com/wiki/4.3inch_Capacitive_Touch_LCD">Wiki</a><br><a href="https://www.waveshare.com/w/upload/0/00/4.3inch_Capacitive_Touch_LCD_user_manual_en.pdf">User manual</a></td>
</tr>
</table>

<h3 id="antennas">Antennas and cabinet construction</h3>

<h3 id="pcbs">All PCBs</h3>
<table width="100%">
<col width="25%"></col><col width="50%"></col><col width="25%"></col>
<tr><th>Board</th><th>KiCAD Schematic</th><th>Gerber file</th></tr>
<tr>
  <td><div class="sectionlink"><a href="shield.html">Cora Z7 Theremin Shield</a></div>
    <p>Connected to Cora Z7 board using Arduino/Chipkit connector.</p>
    <p>Two on-board PMods of Cora board are left unused for future extensions.</p>
    <p>Contains additional microSD card socket.</p>
    <p>Used to connect other boards</p>
    <ul>
      <li>Theremin Pitch and Volume sensor oscillators</li>
      <li>TFT Touch Screen</li>
      <li>Encoders board</li>
      <li>Expression pedals board</li>
      <li>Audio I/O PMods: I2S2 and AMP3</li>
    </ul>
    <img width="70%" src="images/new_cora_theremin/cora_theremin_shield_assembled_top.jpg">
    <img width="70%" src="images/new_cora_theremin/cora_theremin_shield_assembled_bottom.jpg">
    <img width="70%" src="images/new_cora_theremin/cora_theremin_shield_assembled_top_on_cora_board_with_pmods.jpg">
  </td>
  <td><a href="pdfs/cora_theremin_shield_schematic_v01.pdf"><img width="90%" src="images/new_cora_theremin/cora_theremin_shield_schematic_v01.png"></a></td>
  <td><a href="gerber/cora_theremin_shield_pcb_v01.zip"><img width="90%" src="images/new_cora_theremin/cora_theremin_pcb_gerber_preview_v01.png"></a>
      <p><a href="https://www.pcbway.com/project/shareproject/Cora_Z7_Theremin___FPGA_based_theremin__theremin_shield_PCB.html"><img src="https://www.pcbway.com/project/img/images/frompcbway.png" alt="PCB from=From pcbway"=Pcbway" /></a>
  </td>
</tr>
<tr>
  <td><div class="sectionlink"><a href="oscillators.html">Oscillator</a></div>
    <p>Two identical oscillator boards are needed for theremin: Pitch oscillator and Volume oscillator.</p>
    <p>Oscillator output is 3.3V digital signal with frequency which depends on coils (0.3..2MHz).</p>
    <p>Each oscillator requires air core inductors with L 0.5..3 mH with high Q (most likely manual winding is required)</p>
    <p><img width="70%" src="images/new_cora_theremin/cora_theremin_oscillators_and_coils.jpg">
  </td>
  <td><a href="pdfs/fpga_theremin_oscillator_schematic_v01.pdf"><img width="90%" src="images/new_cora_theremin/cora_theremin_oscillator_board_schematic_v01.png"></a></td>
  <td><a href="gerber/theremin_sensor_pcb_v01.zip"><img width="70%" src="images/new_cora_theremin/cora_theremin_oscillator_pcb_gerber_preview_v01.png"></a>
      <p><a href="https://www.pcbway.com/project/shareproject/Cora_Z7_Theremin___FPGA_based_theremin__theremin_sensor_oscillator_PCB.html"><img src="https://www.pcbway.com/project/img/images/frompcbway.png" alt="PCB from=From pcbway"=Pcbway"></a>
  </td>
</tr>
<tr>
  <td><div class="sectionlink"><a href="encoders.html">Encoders Board</a></div>
    <ul>
      <li>5 EC11 rotary encoders with push button</li>
      <li>One tact button</li>
      <li>Analog debounding filters for each of 16 signals</li>
      <li>Multiplexer based solution to use 5 FPGA pins instead of 16</li>
    </ul>
    <p><img width="90%" src="images/new_cora_theremin/cora_theremin_encoders_board_assembled_top.jpg"><br><img width="90%" src="images/new_cora_theremin/cora_theremin_encoders_board_assembled_bottom.jpg">
  </td>
  <td><a href="pdfs/fpga_theremin_encoders_board_v01.pdf"><img width="90%" src="images/new_cora_theremin/cora_theremin_encoders_board_schematic_v01.png"></a></td>
  <td><a href="gerber/fpga_theremin_encoders_board_pcb_v01.zip"><img width="90%" src="images/new_cora_theremin/cora_theremin_encoders_board_pcb_gerber_preview_v01.png"></a>
      <p><a href="https://www.pcbway.com/project/shareproject/Cora_Z7_Theremin___FPGA_based_theremin__encoders_PCB.html"><img src="https://www.pcbway.com/project/img/images/frompcbway.png" alt="PCB from=From pcbway"=Pcbway"></a>
  </td>
</tr>
<tr>
  <td><div class="sectionlink">Expression Pedal Connectors</div><p></td>
  <td><a href="pdfs/cora_theremin_expression_pedal_connectors_board_schematic_v01.pdf"><img width="90%" src="images/new_cora_theremin/cora_theremin_expression_pedal_connectors_board_schematic_v01.png"></a></td>
  <td><a href="gerber/pedal_board_pcb_v01.zip"><img width="90%" src="images/new_cora_theremin/cora_theremin_expression_pedal_connectors_board_pcb_gerber_preview_v01.png"></a>
      <p><a href="https://www.pcbway.com/project/shareproject/Cora_Z7_Theremin___FPGA_based_theremin__expression_pedal_connectors_PCB.html"><img src="https://www.pcbway.com/project/img/images/frompcbway.png" alt="PCB from=From pcbway"=Pcbway"></a>
  </td>
</tr>
<tr>
  <td><div class="sectionlink">Audio Connectors</div><p></td>
  <td><a href="pdfs/cora_theremin_audio_connectors_board_schematic_v01.pdf"><img width="90%" src="images/new_cora_theremin/cora_theremin_audio_connector_board_schematic_v01.png"></a></td>
  <td><a href="gerber/audio_connectors_board_pcb_v01.zip"><img width="60%" src="images/new_cora_theremin/cora_theremin_audio_connectors_board_pcb_gerber_preview_v01.png"></a>
      <p><a href="https://www.pcbway.com/project/shareproject/Cora_Z7_Theremin___FPGA_based_theremin__audio_connectors_PCB.html"><img src="https://www.pcbway.com/project/img/images/frompcbway.png" alt="PCB from=From pcbway"=Pcbway"></a>
  </td>
</tr>
<tr>
  <td><div class="sectionlink">PMod adapter</div>
    <p>Used to mount two (I2S2 and AMP3) PMods on top of shield board, leaving on-board PMod ports of Cora Z7 board unused for future extension.</p>
    <img width="70%" src="images/new_cora_theremin/cora_theremin_pmod_adapters_assembled.jpg">
  </td>
  <td><a href="pdfs/cora_theremin_pmod_connector_board_schematic_v01.pdf"><img width="90%" src="images/new_cora_theremin/cora_theremin_pmod_adapter_board_schematic_v01.png"></a></td>
  <td><a href="gerber/pmod_connector_board_pcb_v01.zip"><img width="50%" src="images/new_cora_theremin/cora_theremin_pmod_adapter_board_pcb_gerber_preview_v01.png"></a>
      <p><a href="https://www.pcbway.com/project/shareproject/Cora_Z7_Theremin___FPGA_based_theremin__PMod_adapter_PCB.html"><img src="https://www.pcbway.com/project/img/images/frompcbway.png" alt="PCB from=From pcbway"=Pcbway"></a>
  </td>
</tr>
<tr>
  <td><div class="sectionlink">LCD Mount</div><p><img width="60%" src="images/new_cora_theremin/core_theremin_display_mounting.jpg"></td>
  <td>No schematic. It's just for mounting of Waveshare 4.3inch 800x480 touch LCD</td>
  <td><a href="gerber/lcd_mount_pcb_v01.zip"><img width="90%" src="images/new_cora_theremin/cora_theremin_lcd_mount_board_pcb_gerber_preview_v01.png"></a>
      <p><a href="https://www.pcbway.com/project/shareproject/Cora_Z7_Theremin___FPGA_based_theremin__LCD_mount_PCB.html"><img src="https://www.pcbway.com/project/img/images/frompcbway.png" alt="PCB from=From pcbway"=Pcbway"></a>
  </td>
</tr>
</table>

<h2 id="software">Software</h2>

<p>This is FPGA PSOC project. Source code consists of two parts: PL (FPGA) and PS (C++ code for ARM core).</p>
<p>Source code is available on <a href="https://github.com/fpga-theremin/theremin/tree/master/fpga/ip_repo">GitHub</a></p>
<p>Design of FPGA IP (SystemVerilog modules) and standalone drivers can be found on separate board related pages</p>

<h2 id="links">Useful links</h2>

<ul>
  <li><a href="http://thereminworld.com/Forums/Topics/theremin-construction">Theremin World Forum: Theremin Construction</a></li>
  <li><a href="http://thereminworld.com/Forums/T/28554/lets-design-and-build-a-mostly-digital-theremin">Theremin World Forum: Dewster's epic topic about FPGA theremin construction (started 2012)</a></li>
  <li><a href="http://thereminworld.com/Forums/T/32203/lets-design-and-build-cool-but-expensive-fpga-based-theremin">Theremin World Forum: topic about this project</a></li>
  <li><a href="https://github.com/fpga-theremin/theremin/">Project page on GitHub</a>
</ul>
</div>
</body>
<p class="footer">FPGA Theremin Project (c) Vadim Lopatin 2019 coolreader.org@gmail.com</p>
</html>
